# 4.6 售后服务管理

## 概述

售后服务管理模块是重泵公司一体化管理系统的重要组成部分，用于管理售后服务的全生命周期，包括售后信息录入、分配、执行、评价，以及设备信息管理、维护计划管理和售后经验沉淀等功能。

## 模块结构

### 包结构
```
org.example.rootmanage.aftersales
├── entity/              # 实体类
├── repository/          # 数据访问层
├── dto/                 # 数据传输对象
├── *Service.java        # 业务逻辑层
└── *Controller.java     # 控制器层
```

---

## 4.6.1 售后信息录入及分配

### 功能描述

由销售人员、售后服务人员或售后内勤录入需要售后的服务请求信息，且售后信息可与该设备主合同进行关联，同时可将客户发来的售后请求以附件形式挂在该售后信息上。

售后内勤对录入售后服务请求的同时，需在系统中选择该服务类型，具体分为：
1. 故障处理
2. 安装调试
3. 有偿售后
4. 无偿三包

选择售后类型后，需指定相应的销售合同，包含：客户单位、主合同号、付款计划等。销售内勤可将技术人员确定的维修方案和换件清单以附件形式，挂在该售后服务单上。

新增服务后，可直接生成售后服务单，并指派给相应处理人员。当选择"无偿三包"时，需通过流程审核，确定是否收取费用。

### 核心实体

#### AfterSalesOrder（售后服务单）
- **服务单号**：唯一标识，系统可自动生成
- **售后类型**：故障处理、安装调试、有偿售后、无偿三包
- **合同关联**：关联主合同，包含合同编号、合同名称
- **客户信息**：业主单位、地区
- **服务信息**：售后时间、付款计划
- **附件支持**：
  - 维修方案附件
  - 换件清单附件
  - 客户请求附件
- **受理人员**：指派处理人员（ID和姓名）
- **服务状态**：待分配、处理中、已完成、已取消
- **审批流程**：无偿三包类型需要审批（待审批、审批中、已通过、已拒绝）
- **完成信息**：完成日期、设备编号、设备名称、售后总结
- **评价信息**：售后评价（优、良、中、差）、评价人、评价时间、是否已关闭

#### AfterSalesType（售后类型枚举）
```java
TROUBLESHOOTING          // 故障处理
INSTALLATION_DEBUGGING   // 安装调试
PAID_SERVICE            // 有偿售后
FREE_WARRANTY           // 无偿三包
```

### API接口

#### 售后服务单管理
- `GET /api/after-sales` - 获取售后服务单列表（支持关键词搜索）
- `GET /api/after-sales/{id}` - 获取售后服务单详情
- `POST /api/after-sales` - 新增售后服务单
- `PUT /api/after-sales/{id}` - 修改售后服务单
- `DELETE /api/after-sales/{id}` - 删除售后服务单

#### 指派受理人员
- `POST /api/after-sales/{id}/assign-handler` - 指派受理人员（生成服务单并分配）

#### 查询待办事宜
- `GET /api/after-sales/pending/{handlerId}` - 根据受理人员ID查询待办事宜

---

## 4.6.2 返厂泵信息查询

### 功能描述

通过重泵公司自制收发货平台，可查询重泵公司返厂泵信息。

### 核心实体

#### ReturnedPump（返厂泵）
- **合同关联**：关联合同，包含合同编号、合同名称
- **返厂信息**：返厂泵名称、返厂时间、泵型号
- **备注**：其他相关信息

### API接口

- `GET /api/returned-pumps` - 获取返厂泵列表（支持关键词搜索）
- `GET /api/returned-pumps/contract/{contractId}` - 根据合同ID获取返厂泵列表
- `GET /api/returned-pumps/{id}` - 获取返厂泵详情
- `POST /api/returned-pumps` - 创建返厂泵信息
- `PUT /api/returned-pumps/{id}` - 更新返厂泵信息
- `DELETE /api/returned-pumps/{id}` - 删除返厂泵信息

---

## 4.6.3 维修进度查询

### 功能描述

通过信息化平台系统，查询三包及有偿维修合同的换件清单、拆解报告（附件）、运行部下的计划、装配车间的扣套时间、预计发货的时间等。

### 核心实体

#### MaintenanceProgress（维修进度）
- **合同关联**：关联合同，包含合同编号、合同名称、合同类型
- **附件信息**：
  - 换件清单附件
  - 拆解报告附件
  - 计划附件（运行部下的计划）
- **时间信息**：
  - 扣套时间（装配车间）
  - 预计发货时间
- **备注**：其他相关信息

### API接口

- `GET /api/maintenance-progress` - 获取维修进度列表（支持关键词搜索）
- `GET /api/maintenance-progress/contract/{contractId}` - 根据合同ID获取维修进度
- `GET /api/maintenance-progress/{id}` - 获取维修进度详情
- `POST /api/maintenance-progress` - 创建或更新维修进度
- `PUT /api/maintenance-progress/{id}` - 更新维修进度
- `DELETE /api/maintenance-progress/{id}` - 删除维修进度

---

## 4.6.4 售后服务执行管理

### 功能描述

售后处理人员可通过系统查看其对应的售后服务单待办事宜。可对该售后服务单进行售后服务过程记录。服务完成后，再对该售后服务单进行服务完结操作。同时，将消息传递至对应的片区领导处进行确认。

片区领导可将完结的售后服务单分配给相应销售人员，对该售后服务单售后处理情况进行客户回访后评价。

### 4.6.4.1 售后服务执行

#### 功能描述

售后处理人员查看待办事宜，进行售后服务过程记录（跟踪），服务完成后进行完结操作（录入设备编号），选择对应合同下的设备列表。

#### 核心实体

#### AfterSalesActivity（售后服务活动）
- **关联服务单**：关联售后服务单
- **活动类型**：跟踪、完成、评价等
- **活动时间**：活动发生日期
- **说明**：情况说明
- **操作人**：操作人ID和姓名

#### Device（设备）
- **设备编号**：唯一标识
- **设备名称**：设备名称
- **合同关联**：关联合同，包含合同编号
- **设备型号**：设备型号
- **出厂时间**：生产时间
- **运行参数**：设备运行参数
- **所用零件信息**：零件信息
- **备注**：其他信息

### API接口

#### 售后服务活动（跟踪记录）
- `POST /api/after-sales/activities` - 添加售后服务活动（跟踪记录）
- `GET /api/after-sales/{id}/activities` - 查询售后服务单的活动列表

#### 完成售后服务
- `POST /api/after-sales/{id}/complete` - 完成售后服务（录入设备编号、售后总结）

#### 设备管理
- `GET /api/devices` - 获取设备列表（支持关键词搜索）
- `GET /api/devices/contract/{contractId}` - 根据合同ID获取设备列表
- `GET /api/devices/{id}` - 获取设备详情
- `POST /api/devices` - 创建设备
- `PUT /api/devices/{id}` - 更新设备
- `DELETE /api/devices/{id}` - 删除设备

### 4.6.4.2 售后服务评价

#### 功能描述

服务完成后，所属片区领导可将该服务分配给指定员工，回访服务情况，并上报。指定销售人员，通过列表查看需售后回访的信息。回访完成后对售后服务进行评价。点击"保存"后，自动提交该评价并关闭该售后服务单。

### API接口

#### 评价管理
- `POST /api/after-sales/{id}/evaluate` - 评价售后服务
- `GET /api/after-sales/completed` - 查询已完成的售后服务单（用于评价列表）
- `GET /api/after-sales/for-evaluation` - 查询需要回访的售后服务单（已完成但未评价）

---

## 4.6.7 售后4S店管理

### 4.6.7.1 设备信息管理

#### 功能描述

系统可对重泵公司所有销售的产品建立相应的设备信息档案，记录该泵的生产时间、运行参数、所用零件等信息。

同时，在设备每次售后维护时，均由售后人员对该设备的维修故障原因进行录入，并记录解决方案，零件更换情况等信息，若是外供零件出现问题，则还需在系统中录入外供设备厂家及设备型号等信息，用于质量原因分析。

通过设备信息管理，不但可形成重泵公司的销售设备台账，同时可对具体每台泵的售后运行及维护情况进行详细跟踪。

#### 核心实体

#### Device（设备）- 已扩展
- **基本信息**：设备编号、设备名称、设备型号
- **合同关联**：关联合同，包含合同编号
- **生产信息**：出厂时间（生产时间）
- **技术参数**：运行参数、所用零件信息
- **备注**：其他信息

#### DeviceMaintenanceRecord（设备维护记录）
- **设备关联**：关联设备，包含设备编号
- **维护信息**：
  - 维护日期
  - 故障原因
  - 解决方案
  - 零件更换情况
- **外供零件信息**：
  - 是否外供零件问题
  - 外供设备厂家
  - 外供设备型号
- **维护人员**：维护人员ID和姓名
- **备注**：其他信息

### API接口

#### 设备维护记录
- `GET /api/device-maintenance-records` - 获取维护记录列表
- `GET /api/device-maintenance-records/device/{deviceId}` - 根据设备ID获取维护记录列表
- `GET /api/device-maintenance-records/device-number/{deviceNumber}` - 根据设备编号获取维护记录列表
- `GET /api/device-maintenance-records/{id}` - 获取维护记录详情
- `POST /api/device-maintenance-records` - 创建维护记录
- `PUT /api/device-maintenance-records/{id}` - 更新维护记录
- `DELETE /api/device-maintenance-records/{id}` - 删除维护记录

### 4.6.7.2 售后计划管理

#### 功能描述

为提高重泵公司售后服务质量，可对每类或每台设备设定相应的主动售后维护计划时间、维护内容、备件清单等内容。当到达指定时间后，系统可自动提示售后人员。同时，给出预设的维护内容及备件清单，便于售后人员及时维护，提高用户满意度。

当信息化平台中，某合同的设备发货完成后，该设备自动进入售后计划中，当服务计划到期时，系统将提醒售后维护人员执行售后服务。

#### 计划类型

1. **按设备型号制定售后计划**（设备类型级别）
   - 每种设备类型只能拥有一套维护计划
   - 适用于该类型的所有设备

2. **按具体设备制定售后计划**（设备级别）
   - 针对具体设备制定个性化维护计划
   - 覆盖设备类型级别的计划

#### 核心实体

#### MaintenancePlan（维护计划）
- **计划类型**：使用PlanType枚举（DEVICE_TYPE或SPECIFIC_DEVICE）
- **设备类型关联**：当planType为DEVICE_TYPE时使用
- **设备关联**：当planType为SPECIFIC_DEVICE时使用
- **计划信息**：
  - 维护周期
  - 维护项目
  - 注意事项
  - 备注
- **状态**：是否启用、是否有售后计划

#### PlanType（维护计划类型枚举）
```java
DEVICE_TYPE        // 设备类型级别（按设备型号制定售后计划）
SPECIFIC_DEVICE    // 具体设备级别（按具体设备制定售后计划）
```

#### ReplacementPartItem（换件清单项）
- **维护计划关联**：关联维护计划
- **零件信息**：
  - 零件图号
  - 名称
  - 材料
  - 数量
- **排序**：排序序号

### API接口

#### 维护计划管理
- `GET /api/maintenance-plans` - 获取维护计划列表（支持关键词和计划类型筛选）
- `GET /api/maintenance-plans/device-type/{deviceType}` - 根据设备类型获取维护计划（设备类型级别）
- `GET /api/maintenance-plans/device/{deviceId}` - 根据设备ID获取维护计划（具体设备级别）
- `GET /api/maintenance-plans/{id}` - 获取维护计划详情
- `POST /api/maintenance-plans` - 创建维护计划（包含换件清单项）
- `PUT /api/maintenance-plans/{id}` - 更新维护计划（包含换件清单项）
- `DELETE /api/maintenance-plans/{id}` - 删除维护计划

### 4.6.7.3 售后经验管理

#### 功能描述

系统可记录每种设备出现过的问题和解决方案，实现维修经验的沉淀，为重泵公司维修人员培训提供平台支撑；同时，在实际维修中，可查询类似维修经验，为重泵公司逐步构建的维修保障平台提供技术支持。

#### 核心实体

#### AfterSalesExperience（售后经验）
- **客户信息**：客户名称
- **设备信息**：设备类型
- **案例信息**：
  - 案例登记时间
  - 案例类型
  - 案例备注
- **经验总结**：详细的经验总结
- **附件**：相关附件路径
- **登记人**：登记人ID和姓名

### API接口

#### 售后经验管理
- `GET /api/after-sales-experiences` - 获取售后经验列表（支持关键词、设备类型、案例类型筛选）
- `GET /api/after-sales-experiences/{id}` - 获取售后经验详情
- `POST /api/after-sales-experiences` - 创建售后经验
- `PUT /api/after-sales-experiences/{id}` - 更新售后经验
- `DELETE /api/after-sales-experiences/{id}` - 删除售后经验

---

## 数据模型关系图

```
Contract (合同)
    ├── AfterSalesOrder (售后服务单)
    │   └── AfterSalesActivity (售后服务活动)
    ├── Device (设备)
    │   ├── DeviceMaintenanceRecord (设备维护记录)
    │   └── MaintenancePlan (维护计划 - 具体设备)
    │       └── ReplacementPartItem (换件清单项)
    ├── ReturnedPump (返厂泵)
    └── MaintenanceProgress (维修进度)

MaintenancePlan (维护计划 - 设备类型)
    └── ReplacementPartItem (换件清单项)

AfterSalesExperience (售后经验) - 独立实体
```

---

## 业务流程图

### 售后服务流程

1. **录入阶段**
   - 销售人员/售后服务人员/售后内勤录入服务请求
   - 选择售后类型（故障处理/安装调试/有偿售后/无偿三包）
   - 关联主合同
   - 上传附件（客户请求、维修方案、换件清单）

2. **分配阶段**
   - 售后内勤指派受理人员
   - 如果是无偿三包，启动审批流程

3. **执行阶段**
   - 受理人员查看待办事宜
   - 记录售后服务过程（跟踪记录）
   - 服务完成后录入设备编号和售后总结

4. **评价阶段**
   - 片区领导分配销售人员回访
   - 销售人员查看需回访信息
   - 进行售后评价
   - 提交评价并关闭服务单

### 设备维护流程

1. **设备档案建立**
   - 合同设备发货完成后，自动建立设备档案
   - 记录设备基本信息、生产时间、运行参数、所用零件

2. **维护记录**
   - 每次售后维护时记录故障原因、解决方案、零件更换情况
   - 如果是外供零件问题，记录外供厂家和型号

3. **维护计划**
   - 按设备类型或具体设备制定维护计划
   - 包含维护周期、维护项目、注意事项、换件清单
   - 系统自动提醒到期维护

4. **经验沉淀**
   - 记录设备问题和解决方案
   - 形成维修经验库
   - 支持查询类似维修经验

---

## 技术实现

### 实体类列表

1. **AfterSalesOrder** - 售后服务单
2. **AfterSalesType** - 售后类型枚举
3. **PlanType** - 维护计划类型枚举
4. **AfterSalesActivity** - 售后服务活动
5. **Device** - 设备
6. **DeviceMaintenanceRecord** - 设备维护记录
7. **ReturnedPump** - 返厂泵
8. **MaintenanceProgress** - 维修进度
9. **MaintenancePlan** - 维护计划
10. **ReplacementPartItem** - 换件清单项
11. **AfterSalesExperience** - 售后经验

### Service类列表

1. **AfterSalesService** - 售后服务业务逻辑
2. **DeviceService** - 设备管理业务逻辑
3. **DeviceMaintenanceRecordService** - 设备维护记录业务逻辑
4. **ReturnedPumpService** - 返厂泵业务逻辑
5. **MaintenanceProgressService** - 维修进度业务逻辑
6. **MaintenancePlanService** - 维护计划业务逻辑
7. **AfterSalesExperienceService** - 售后经验业务逻辑

### Controller类列表

1. **AfterSalesController** - 售后服务管理接口
2. **DeviceController** - 设备管理接口
3. **DeviceMaintenanceRecordController** - 设备维护记录接口
4. **ReturnedPumpController** - 返厂泵管理接口
5. **MaintenanceProgressController** - 维修进度管理接口
6. **MaintenancePlanController** - 维护计划管理接口
7. **AfterSalesExperienceController** - 售后经验管理接口

---

## 注意事项

1. **服务单号生成**：如果未提供服务单号，系统会自动生成（格式：AS + 日期 + 时间）

2. **审批流程**：选择"无偿三包"类型时，系统自动设置需要审批，状态为"待审批"

3. **设备类型计划唯一性**：每种设备类型只能有一个维护计划，创建时会检查

4. **设备关联**：设备可以关联合同，支持通过合同ID或合同编号关联

5. **附件存储**：所有附件路径以字符串形式存储，实际文件上传功能需要单独实现

6. **数据冗余**：为了查询性能，部分实体中存储了冗余字段（如合同编号、合同名称等）

---

## 4.6.8 远程设备状态采集

### 概述

远程设备状态采集模块实现重泵公司对外销售设备的远程监控和数据采集功能，与重泵公司现有的数据采集系统相结合，实现设备运行状态的实时监视、报警管理和数据分析。

### 包结构
```
org.example.rootmanage.remotemonitoring
├── entity/              # 实体类
├── repository/          # 数据访问层
├── dto/                 # 数据传输对象
├── *Service.java        # 业务逻辑层
└── *Controller.java     # 控制器层
```

---

### 4.6.8.1 基础信息管理配置

#### 1）数据收集

与重泵公司现有的数据采集系统相结合，将远程采集的数据在统一的数据库中进行存储、管理。

#### 核心实体

##### DeviceRunningData（设备运行数据）
- **点位关联**：关联数据点位
- **采集时间**：数据采集时间
- **采集值**：经过倍率转换后的值
- **原始值**：未经倍率转换的原始值
- **数据质量**：GOOD-良好, BAD-坏数据, UNCERTAIN-不确定
- **数据来源**：AUTO-自动采集, MANUAL-手动录入, CALCULATED-公式计算

##### DataStatistics（数据统计）
- **统计周期**：HOURLY-小时, DAILY-天, WEEKLY-周, MONTHLY-月
- **统计数据**：平均值、最大值、最小值、累计值、数据点数

---

#### 2）空间模型配置

通过系统平台建模工具，配置需要管理的建筑物树形架构。

#### 核心实体

##### SpaceNode（空间节点）
- **节点编码**：唯一标识
- **节点名称**：节点名称
- **节点类型**：COMPANY-公司, REGION-区域, BUILDING-建筑, FLOOR-楼层, ROOM-房间
- **父节点**：支持树形结构
- **节点层级**：从1开始
- **位置信息**：地址、经度、纬度
- **联系信息**：联系人、联系电话
- **状态**：是否启用

#### API接口

- `GET /api/remote-monitoring/space-nodes` - 获取空间节点列表（支持关键词搜索）
- `GET /api/remote-monitoring/space-nodes/tree` - 获取空间节点树形结构
- `GET /api/remote-monitoring/space-nodes/parent/{parentId}` - 根据父节点ID获取子节点
- `GET /api/remote-monitoring/space-nodes/type/{nodeType}` - 根据节点类型查找
- `GET /api/remote-monitoring/space-nodes/{id}` - 获取空间节点详情
- `POST /api/remote-monitoring/space-nodes` - 创建空间节点
- `PUT /api/remote-monitoring/space-nodes/{id}` - 更新空间节点
- `DELETE /api/remote-monitoring/space-nodes/{id}` - 删除空间节点

---

#### 3）表计配置

##### 核心实体

##### Meter（表计）
- **表计编号**：唯一标识
- **表计名称**：表计名称
- **表计类型**：WATER-水表, ELECTRIC-电表, PRESSURE-压力表, FLOW-流量计, TEMPERATURE-温度计, VIBRATION-振动传感器等
- **表计功能**：功能描述
- **表计型号**：型号
- **表计单位**：单位
- **表计倍率**：倍率
- **安装信息**：安装位置、安装日期
- **关联**：所属空间节点、关联设备
- **通信配置**：通信协议、通信地址

##### MeterAttribute（表计静态属性）
- **属性名称**：名称
- **属性编码**：编码
- **属性值**：值
- **属性类型**：STRING-字符串, NUMBER-数值, DATE-日期, BOOLEAN-布尔
- **属性单位**：单位

##### MeterMeasurement（表计检测属性）
- **检测属性名称**：如流量、压力、温度、电压、电流、功率等
- **检测属性编码**：编码
- **检测属性类型**：ANALOG-模拟量, DIGITAL-数字量, CUMULATIVE-累计量
- **单位**：单位
- **量程**：最小值、最大值
- **精度**：小数位数
- **关联点位**：绑定的数据点位

#### API接口

- `GET /api/remote-monitoring/meters` - 获取表计列表（支持关键词搜索）
- `GET /api/remote-monitoring/meters/type/{meterType}` - 根据表计类型查找
- `GET /api/remote-monitoring/meters/space-node/{spaceNodeId}` - 根据空间节点查找
- `GET /api/remote-monitoring/meters/device/{deviceId}` - 根据设备查找
- `GET /api/remote-monitoring/meters/{id}` - 获取表计详情
- `POST /api/remote-monitoring/meters` - 创建表计（包含静态属性和检测属性）
- `PUT /api/remote-monitoring/meters/{id}` - 更新表计
- `DELETE /api/remote-monitoring/meters/{id}` - 删除表计

---

#### 4）设备配置

##### 核心实体

##### DeviceModel（设备模型）
- **模型编码**：唯一标识
- **模型名称**：名称
- **设备类型**：类型
- **设备品牌**：品牌
- **设备规格**：规格
- **额定参数**：额定功率、额定电压、额定电流、额定流量、额定扬程
- **模型描述**：描述
- **状态**：是否启用

##### DeviceModelAttribute（设备模型属性）
- **属性名称**：名称
- **属性编码**：编码
- **属性默认值**：默认值
- **属性类型**：STRING-字符串, NUMBER-数值, DATE-日期, BOOLEAN-布尔
- **是否必填**：必填标志

#### API接口

- `GET /api/remote-monitoring/device-models` - 获取设备模型列表（支持关键词搜索）
- `GET /api/remote-monitoring/device-models/type/{deviceType}` - 根据设备类型查找
- `GET /api/remote-monitoring/device-models/enabled` - 获取启用的设备模型
- `GET /api/remote-monitoring/device-models/{id}` - 获取设备模型详情
- `POST /api/remote-monitoring/device-models` - 创建设备模型（包含属性列表）
- `PUT /api/remote-monitoring/device-models/{id}` - 更新设备模型
- `DELETE /api/remote-monitoring/device-models/{id}` - 删除设备模型

---

#### 5）点位配置

##### 核心实体

##### DataPoint（数据点位）
- **点位编码**：唯一标识
- **点位名称**：名称
- **点位类型**：REAL-实点, VIRTUAL-虚点
- **数据类型**：ANALOG-模拟量, DIGITAL-数字量, CUMULATIVE-累计量
- **关联表计**：关联的表计和检测属性
- **单位**：单位
- **采集倍率**：倍率
- **采集模式**：REALTIME-实时采集, POLLING-轮询采集, MANUAL-手动录入
- **采集周期**：采集间隔（秒）
- **量程**：最小值、最大值
- **精度**：小数位数
- **通信配置**：通信协议、通信地址、寄存器地址
- **当前值**：最新采集值
- **最后采集时间**：最后采集时间
- **状态**：是否启用、是否报警点位

#### API接口

- `GET /api/remote-monitoring/data-points` - 获取点位列表（支持关键词搜索）
- `GET /api/remote-monitoring/data-points/type/{pointType}` - 根据点位类型查找
- `GET /api/remote-monitoring/data-points/meter/{meterId}` - 根据表计查找
- `GET /api/remote-monitoring/data-points/collection-mode/{collectionMode}` - 根据采集模式查找
- `GET /api/remote-monitoring/data-points/{id}` - 获取点位详情
- `POST /api/remote-monitoring/data-points` - 创建点位
- `PUT /api/remote-monitoring/data-points/{id}` - 更新点位
- `DELETE /api/remote-monitoring/data-points/{id}` - 删除点位
- `POST /api/remote-monitoring/data-points/manual-input` - 手动录入数据

---

#### 6）公式配置

##### 核心实体

##### VirtualMeterFormula（虚拟表计公式）
- **公式编码**：唯一标识
- **公式名称**：名称
- **输出点位**：计算结果输出的虚拟点位
- **公式表达式**：如 "P001 + P002 * 0.5 - P003"
- **公式说明**：说明
- **计算精度**：小数位数
- **状态**：是否启用

##### FormulaParameter（公式参数）
- **参数名称**：在公式中的变量名
- **关联点位**：关联的物理表计点位
- **系数/权重**：系数
- **运算符**：ADD-加, SUBTRACT-减, MULTIPLY-乘, DIVIDE-除

#### API接口

- `GET /api/remote-monitoring/formulas` - 获取公式列表（支持关键词搜索）
- `GET /api/remote-monitoring/formulas/enabled` - 获取启用的公式
- `GET /api/remote-monitoring/formulas/{id}` - 获取公式详情
- `POST /api/remote-monitoring/formulas` - 创建公式（包含参数列表）
- `PUT /api/remote-monitoring/formulas/{id}` - 更新公式
- `DELETE /api/remote-monitoring/formulas/{id}` - 删除公式

---

#### 7）分析模型配置

##### 核心实体

##### AnalysisModel（分析模型）
- **模型编码**：唯一标识
- **模型名称**：名称
- **模型类型**：DEVICE-按设备分类, CUSTOMER-按销售对象分类, REGION-按区域分类, DEVICE_TYPE-按设备类型分类, COMPREHENSIVE-综合分析
- **父模型**：支持树形结构
- **模型层级**：从1开始
- **模型描述**：描述
- **状态**：是否启用

##### AnalysisModelPoint（分析模型点位关联）
- **关联点位**：数据点位
- **点位显示名称**：自定义显示名称
- **曲线分析分组**：如电流、压力、振动频率等
- **曲线颜色**：曲线显示颜色
- **Y轴范围**：Y轴最小值、最大值

#### API接口

- `GET /api/remote-monitoring/analysis-models` - 获取分析模型列表（支持关键词搜索）
- `GET /api/remote-monitoring/analysis-models/tree` - 获取分析模型树形结构
- `GET /api/remote-monitoring/analysis-models/parent/{parentId}` - 根据父模型获取子模型
- `GET /api/remote-monitoring/analysis-models/type/{modelType}` - 根据模型类型查找
- `GET /api/remote-monitoring/analysis-models/{id}` - 获取分析模型详情
- `GET /api/remote-monitoring/analysis-models/{id}/points` - 获取分析模型的关联点位
- `GET /api/remote-monitoring/analysis-models/{id}/points/group/{curveGroup}` - 根据曲线分组获取点位
- `POST /api/remote-monitoring/analysis-models` - 创建分析模型（包含点位关联）
- `PUT /api/remote-monitoring/analysis-models/{id}` - 更新分析模型
- `DELETE /api/remote-monitoring/analysis-models/{id}` - 删除分析模型

---

### 4.6.8.2 设备运行监视

#### 1）实时监视功能

##### API接口

- `GET /api/remote-monitoring/monitoring/realtime` - 获取所有点位的实时数据
- `GET /api/remote-monitoring/monitoring/realtime/{dataPointId}` - 根据点位ID获取实时数据
- `GET /api/remote-monitoring/monitoring/realtime/analysis-model/{analysisModelId}` - 根据分析模型获取实时数据

---

#### 2）报警功能

##### 核心实体

##### AlarmConfig（报警配置）
- **报警编码**：唯一标识
- **报警名称**：名称
- **关联点位**：数据点位
- **报警类型**：HIGH-超上限, LOW-超下限, CHANGE-变化率, STATUS-状态变化, RANGE-区间报警
- **报警级别**：INFO-信息, WARNING-警告, ERROR-错误, CRITICAL-严重
- **阈值**：上限值、下限值
- **死区值**：防止频繁报警
- **延迟时间**：超过阈值多久后才报警
- **报警描述模板**：报警消息模板
- **状态**：是否启用
- **通知配置**：是否发送通知、通知方式、通知接收人

##### AlarmRecord（报警记录）
- **关联配置**：报警配置
- **关联点位**：数据点位
- **报警信息**：报警类型、报警级别、报警时间、报警值、阈值、报警消息
- **恢复时间**：报警恢复时间
- **报警状态**：ACTIVE-活动, ACKNOWLEDGED-已确认, RECOVERED-已恢复
- **确认信息**：确认人、确认时间、处理备注

##### API接口

**报警配置管理**
- `GET /api/remote-monitoring/alarms/configs` - 获取报警配置列表（支持关键词搜索）
- `GET /api/remote-monitoring/alarms/configs/data-point/{dataPointId}` - 根据点位获取报警配置
- `GET /api/remote-monitoring/alarms/configs/{id}` - 获取报警配置详情
- `POST /api/remote-monitoring/alarms/configs` - 创建报警配置
- `PUT /api/remote-monitoring/alarms/configs/{id}` - 更新报警配置
- `DELETE /api/remote-monitoring/alarms/configs/{id}` - 删除报警配置

**报警记录管理**
- `GET /api/remote-monitoring/alarms/records/active` - 获取活动的报警记录
- `GET /api/remote-monitoring/alarms/records/status/{status}` - 根据状态获取报警记录
- `GET /api/remote-monitoring/alarms/records/data-point/{dataPointId}` - 根据点位获取报警记录
- `GET /api/remote-monitoring/alarms/records/time-range` - 根据时间范围获取报警记录
- `GET /api/remote-monitoring/alarms/records/{id}` - 获取报警记录详情
- `POST /api/remote-monitoring/alarms/records/{id}/acknowledge` - 确认报警
- `POST /api/remote-monitoring/alarms/records/{id}/recover` - 恢复报警

---

#### 3）曲线分析功能

##### API接口

- `POST /api/remote-monitoring/monitoring/curve-analysis` - 获取曲线分析数据（支持集成曲线和分类曲线）
- `GET /api/remote-monitoring/monitoring/curve-analysis/hourly` - 获取小时曲线分析数据
- `GET /api/remote-monitoring/monitoring/curve-analysis/daily` - 获取日曲线分析数据

##### 曲线分析请求参数

```json
{
  "dataPointIds": ["uuid1", "uuid2"],  // 点位ID列表
  "analysisModelId": "uuid",            // 或使用分析模型ID
  "startTime": "2024-01-01T00:00:00",   // 开始时间
  "endTime": "2024-01-02T00:00:00",     // 结束时间
  "period": "HOURLY",                   // 时间粒度：HOURLY/DAILY/WEEKLY/MONTHLY
  "curveGroup": "压力"                  // 曲线分组（用于分类曲线分析）
}
```

---

#### 4）在线数据分析

##### API接口

- `GET /api/remote-monitoring/monitoring/reports/daily` - 获取日报数据
- `GET /api/remote-monitoring/monitoring/reports/weekly` - 获取周报数据
- `GET /api/remote-monitoring/monitoring/reports/monthly` - 获取月报数据

---

#### 5）历史数据查询

##### API接口

- `GET /api/remote-monitoring/monitoring/history/{dataPointId}` - 查询历史数据
- `GET /api/remote-monitoring/monitoring/history/{dataPointId}/latest` - 获取点位最新数据

---

### 4.6.8.3 专家分析

将重泵公司专家分析系统进行集成。（后续扩展）

---

### 数据模型关系图（远程设备状态采集）

```
SpaceNode (空间节点)
    └── Meter (表计)
        ├── MeterAttribute (表计属性)
        └── MeterMeasurement (表计检测属性)
            └── DataPoint (数据点位)
                ├── DeviceRunningData (设备运行数据)
                ├── DataStatistics (数据统计)
                ├── AlarmConfig (报警配置)
                │   └── AlarmRecord (报警记录)
                └── AnalysisModelPoint (分析模型点位关联)
                    └── AnalysisModel (分析模型)

DeviceModel (设备模型)
    └── DeviceModelAttribute (设备模型属性)

VirtualMeterFormula (虚拟表计公式)
    └── FormulaParameter (公式参数)
        └── DataPoint (关联点位)
```

---

## 后续扩展建议

1. **定时任务**：实现维护计划到期提醒功能
2. **消息通知**：实现服务单状态变更时的消息通知
3. **文件上传**：实现附件上传功能
4. **统计分析**：实现售后服务统计分析功能
5. **审批流程**：完善无偿三包的审批流程实现
6. **设备自动建档**：实现合同设备发货完成后自动建立设备档案的功能
7. **数据采集集成**：实现与重泵公司现有数据采集系统的数据对接
8. **专家分析系统集成**：集成重泵公司专家分析系统
9. **定时统计任务**：实现小时、日、周、月统计数据的自动计算

---

## 更新日志

### 2024年 - 初始版本
- 完成4.6.1 售后信息录入及分配
- 完成4.6.2 返厂泵信息查询
- 完成4.6.3 维修进度查询
- 完成4.6.4 售后服务执行管理
- 完成4.6.7 售后4S店管理（设备信息管理、售后计划管理、售后经验管理）

### 2026年1月 - 远程设备状态采集
- 完成4.6.8 远程设备状态采集功能
  - 基础信息管理配置（空间模型、表计、设备模型、点位、公式、分析模型）
  - 设备运行监视（实时监视、报警功能、曲线分析、在线数据分析）
  - 数据采集和存储

