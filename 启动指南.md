# 集成营销和服务管理系统 - 完整启动指南

本文档提供从零开始的完整启动指南，包括环境准备、数据库配置、初始化和启动步骤。

## 📋 前置要求

### 1. 环境要求

- **Java**: JDK 17 或更高版本
- **Node.js**: 16.x 或更高版本（推荐 18.x）
- **MySQL**: 5.7 或更高版本（推荐 8.0+）
- **Maven**: 3.6+（可选，项目已包含 Maven Wrapper）
- **npm**: 通常随 Node.js 一起安装

### 2. 检查环境

```bash
# 检查 Java 版本
java -version

# 检查 Node.js 版本
node -v

# 检查 npm 版本
npm -v

# 检查 MySQL 是否安装
mysql --version
```

## 🗄️ 数据库配置

### 步骤 1: 安装和启动 MySQL

1. 确保 MySQL 服务已启动
2. 使用 MySQL 客户端连接到数据库服务器

### 步骤 2: 创建数据库

打开 MySQL 命令行或 MySQL Workbench，执行以下命令：

```sql
-- 创建数据库（如果不存在）
CREATE DATABASE IF NOT EXISTS rootmanage 
  DEFAULT CHARACTER SET utf8mb4 
  DEFAULT COLLATE utf8mb4_unicode_ci;

-- 使用数据库
USE rootmanage;
```

### 步骤 3: 配置数据库连接

编辑 `src/main/resources/application.yml` 文件，修改数据库连接信息：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/rootmanage?useSSL=false&characterEncoding=utf8&serverTimezone=UTC&allowPublicKeyRetrieval=true
    username: root          # 修改为你的 MySQL 用户名
    password: 1234567890    # 修改为你的 MySQL 密码
    driver-class-name: com.mysql.cj.jdbc.Driver
```

**注意**: 
- 如果 MySQL 版本是 5.7 或更早，可能需要移除 `&allowPublicKeyRetrieval=true`
- 确保 MySQL 用户有创建表的权限

### 步骤 4: 初始化数据库（可选但推荐）

项目支持两种初始化方式：

#### 方式 A: 自动建表（推荐首次使用）

JPA 会自动创建表结构，但需要手动初始化基础数据：

1. **初始化模块数据**（必须执行）
   ```bash
   mysql -u root -p rootmanage < init_modules.sql
   ```

2. **初始化基础数据**（可选，包含默认管理员账号）
   ```bash
   mysql -u root -p rootmanage < init_data.sql
   ```

3. **添加基本信息管理模块**（如果使用基本信息管理功能）
   ```bash
   mysql -u root -p rootmanage < add_basicinfo_modules.sql
   ```

4. **添加价格本和应收账管理模块**（新增模块，必须执行）
   ```bash
   mysql -u root -p rootmanage < add_pricebook_receivable_modules.sql
   ```

#### 方式 B: 仅自动建表

如果只执行方式 B，项目启动后 JPA 会自动创建所有表结构，但需要：
- 通过前端界面手动创建角色和模块
- 手动注册管理员账号

### 步骤 5: 验证数据库

执行以下 SQL 验证数据库是否创建成功：

```sql
USE rootmanage;
SHOW TABLES;  -- 查看所有表

-- 检查模块表
SELECT COUNT(*) FROM module;

-- 检查角色表
SELECT * FROM role;
```

## 🚀 启动项目

### 方式一: 使用批处理脚本启动（Windows，推荐）

#### 启动前后端（一键启动）

```bash
启动前后端.bat
```

这个脚本会：
1. 检查端口是否被占用（后端 8080，前端 3000）
2. 在新窗口中启动后端服务
3. 自动安装前端依赖（如果是首次运行）
4. 在新窗口中启动前端服务

#### 仅启动后端

```bash
start.bat
```

**注意**: 使用此方式需要先打包项目：
```bash
mvn clean package -DskipTests
```

### 方式二: 手动启动

#### 1. 启动后端服务

**方法 A: 使用 Maven 直接运行（推荐开发环境）**

```bash
mvn spring-boot:run
```

**方法 B: 打包后运行（推荐生产环境）**

```bash
# 1. 打包项目
mvn clean package -DskipTests

# 2. 运行 JAR 文件
java -jar target/rootmanage-1.0-SNAPSHOT.jar
```

**方法 C: 使用 IDE 运行**

1. 使用 IntelliJ IDEA 或 Eclipse 打开项目
2. 找到 `src/main/java/org/example/rootmanage/RootManageApplication.java`
3. 右键 → Run 'RootManageApplication'

#### 2. 启动前端服务

```bash
# 1. 进入前端目录
cd frontend

# 2. 安装依赖（首次运行）
npm install
# 或使用国内镜像（如果下载慢）
npm install --registry=https://registry.npmmirror.com

# 3. 启动开发服务器
npm run dev
```

### 方式三: 使用 Maven Wrapper（无需安装 Maven）

```bash
# Windows
mvnw.cmd spring-boot:run

# Linux/Mac
./mvnw spring-boot:run
```

## ✅ 验证启动

### 后端验证

1. 查看控制台输出，应该看到：
   ```
   Started RootManageApplication in X.XXX seconds
   Tomcat started on port 8080
   ```

2. 访问后端 API 根路径：
   ```
   http://localhost:8080/
   ```
   应该返回 JSON 格式的 API 信息

### 前端验证

1. 查看控制台输出，应该看到：
   ```
   VITE v5.x.x  ready in xxx ms
   ➜  Local:   http://localhost:5173/
   ```

2. 在浏览器中访问前端地址（通常是 `http://localhost:5173` 或 `http://localhost:3000`）

## 🔐 默认登录信息

如果执行了 `init_data.sql`，可以使用以下账号登录：

- **用户名**: `13800000000`
- **密码**: `123456`
- **角色**: 系统管理员

如果没有执行初始化脚本，需要：
1. 访问注册页面注册账号
2. 使用管理员账号审核通过
3. 或直接在数据库中创建管理员账号

## 📝 数据库初始化脚本说明

项目包含以下 SQL 初始化脚本：

| 脚本文件 | 说明 | 是否必须 |
|---------|------|---------|
| `init_modules.sql` | 初始化系统模块（菜单） | ✅ **必须** |
| `init_data.sql` | 初始化基础数据（角色、选项、管理员账号） | ⚠️ 推荐 |
| `add_basicinfo_modules.sql` | 添加基本信息管理模块 | ⚠️ 可选 |
| `add_pricebook_receivable_modules.sql` | 添加价格本和应收账管理模块 | ✅ **必须**（新功能） |

**执行顺序建议**：
1. `init_modules.sql` - 基础模块
2. `init_data.sql` - 基础数据和默认账号
3. `add_basicinfo_modules.sql` - 基本信息管理模块（如需要）
4. `add_pricebook_receivable_modules.sql` - 价格本和应收账模块

## 🔧 常见问题

### 1. 端口被占用

**问题**: 启动时提示端口被占用

**解决方案**:
- 后端端口（8080）：修改 `src/main/resources/application.yml` 中的 `server.port`
- 前端端口（5173/3000）：修改 `frontend/vite.config.js` 中的 `server.port`

### 2. 数据库连接失败

**问题**: 启动时提示数据库连接失败

**解决方案**:
1. 检查 MySQL 服务是否启动
2. 检查 `application.yml` 中的数据库配置是否正确
3. 检查数据库用户是否有足够权限
4. 检查数据库是否存在：`CREATE DATABASE IF NOT EXISTS rootmanage;`

### 3. 前端依赖安装失败

**问题**: `npm install` 失败或很慢

**解决方案**:
```bash
# 使用国内镜像
npm install --registry=https://registry.npmmirror.com

# 或设置永久镜像
npm config set registry https://registry.npmmirror.com
```

### 4. JPA 表创建失败

**问题**: 启动时表创建失败

**解决方案**:
1. 检查数据库用户是否有 CREATE TABLE 权限
2. 检查数据库字符集是否为 utf8mb4
3. 查看错误日志确定具体原因

### 5. 模块菜单不显示

**问题**: 登录后看不到菜单

**解决方案**:
1. 确认已执行 `init_modules.sql`
2. 检查用户角色是否有模块权限
3. 在权限管理中为角色分配模块权限

### 6. 前端无法连接后端

**问题**: 前端报错网络错误

**解决方案**:
1. 检查后端服务是否正常启动
2. 检查 `frontend/src/utils/api.js` 中的 baseURL 配置
3. 检查浏览器控制台的网络请求错误信息

## 📚 下一步

启动成功后，你可以：

1. **登录系统** - 使用默认管理员账号或注册新账号
2. **配置权限** - 在权限管理模块中配置角色和模块权限
3. **添加数据** - 开始使用各个功能模块添加业务数据
4. **查看 API 文档** - 参考 `API_EXAMPLES.md` 了解 API 接口

## 🆘 获取帮助

如果遇到问题：

1. 查看项目 `README.md` 文件
2. 查看后端控制台的错误日志
3. 查看浏览器控制台的错误信息
4. 检查数据库连接和数据是否正确

---

**祝使用愉快！** 🎉

